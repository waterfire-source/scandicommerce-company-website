'use client'

import React, { useEffect, useRef, useState, useMemo } from 'react'

type BlobPage = 'homepage' | 'about' | 'work' | 'resources' | 'partners' | 'contact' | 'merch' | 'services'

interface LiquidBlobProps {
  className?: string
  page?: BlobPage
  rotation?: number
  enableMouseFollow?: boolean
  animationSpeed?: number // Multiplier for animation duration (higher = slower)
  shapeScale?: number // Scale factor for shape variations (higher = more dramatic)
}

const pageShapes: Record<BlobPage, {
  blob1: { shape1: string; shape2: string; shape3: string; shape4: string }
  blob2: { shape1: string; shape2: string; shape3: string; shape4: string }
  shadow1: { shape1: string; shape2: string; shape3: string; shape4: string }
  shadow2: { shape1: string; shape2: string; shape3: string; shape4: string }
}> = {
  homepage: {
    blob1: {
      shape1: 'M500,100 C650,100 800,150 900,300 C1000,450 1000,600 900,750 C800,900 650,950 500,950 C350,950 200,900 100,750 C0,600 0,450 100,300 C200,150 350,100 500,100 Z',
      shape2: 'M520,120 C680,80 850,180 950,350 C1050,520 1020,700 900,850 C780,1000 600,1020 450,980 C300,940 150,850 80,680 C10,510 50,340 150,220 C250,100 380,140 520,120 Z',
      shape3: 'M480,80 C620,120 780,200 880,380 C980,560 960,750 840,890 C720,1030 550,1050 400,1000 C250,950 120,820 60,640 C0,460 40,280 160,160 C280,40 360,50 480,80 Z',
      shape4: 'M510,100 C670,90 830,170 930,340 C1030,510 1010,690 890,840 C770,990 590,1030 440,990 C290,950 140,840 70,660 C0,480 40,300 160,180 C280,60 370,110 510,100 Z',
    },
    blob2: {
      shape1: 'M750,200 C900,180 1050,280 1120,450 C1190,620 1140,800 1020,920 C900,1040 720,1060 580,1000 C440,940 340,820 320,650 C300,480 380,320 500,230 C620,140 620,220 750,200 Z',
      shape2: 'M780,180 C940,150 1100,260 1160,440 C1220,620 1160,820 1030,950 C900,1080 700,1090 550,1020 C400,950 300,810 290,630 C280,450 370,280 510,190 C650,100 640,200 780,180 Z',
      shape3: 'M720,220 C870,200 1020,300 1090,470 C1160,640 1110,830 980,960 C850,1090 670,1100 530,1030 C390,960 300,830 300,660 C300,490 390,330 530,240 C670,150 590,240 720,220 Z',
      shape4: 'M760,190 C910,170 1070,270 1140,450 C1210,630 1150,820 1020,950 C890,1080 700,1100 560,1030 C420,960 320,830 310,655 C300,480 385,310 525,215 C665,120 630,210 760,190 Z',
    },
    shadow1: {
      shape1: 'M500,160 C790,160 1010,330 1010,520 C1010,710 790,880 500,880 C210,880 -10,710 -10,520 C-10,330 210,160 500,160 Z',
      shape2: 'M530,140 C830,150 1030,320 1020,530 C1010,740 800,890 500,880 C200,870 -10,700 10,490 C30,280 260,130 530,140 Z',
      shape3: 'M470,170 C760,160 990,340 980,540 C970,740 760,880 470,870 C180,860 -30,690 0,490 C30,290 200,180 470,170 Z',
      shape4: 'M510,150 C810,160 1020,330 1010,530 C1000,730 790,880 500,870 C210,860 -10,700 10,500 C30,300 240,140 510,150 Z',
    },
    shadow2: {
      shape1: 'M500,180 C780,180 990,340 990,530 C990,720 780,870 500,870 C220,870 10,720 10,530 C10,340 220,180 500,180 Z',
      shape2: 'M530,160 C820,170 1010,330 1000,540 C990,750 780,890 490,880 C200,870 0,710 20,500 C40,290 270,150 530,160 Z',
      shape3: 'M470,190 C750,180 970,350 960,550 C950,750 750,880 460,870 C170,860 -20,700 10,500 C40,300 210,200 470,190 Z',
      shape4: 'M510,170 C800,180 1000,340 990,540 C980,740 780,880 490,870 C200,860 10,710 30,510 C50,310 250,160 510,170 Z',
    },
  },
  about: {
    blob1: {
      shape1: 'M500,180 C780,180 980,340 980,520 C980,700 780,860 500,860 C220,860 20,700 20,520 C20,340 220,180 500,180 Z',
      shape2: 'M520,160 C810,170 1000,330 990,530 C980,730 770,870 490,860 C210,850 10,690 30,490 C50,290 260,150 520,160 Z',
      shape3: 'M480,190 C760,180 960,350 950,540 C940,730 750,860 470,850 C190,840 10,680 30,490 C50,300 220,200 480,190 Z',
      shape4: 'M510,170 C800,180 990,340 980,530 C970,720 770,860 490,850 C210,840 20,690 40,500 C60,310 250,160 510,170 Z',
    },
    blob2: {
      shape1: 'M500,200 C770,200 960,350 960,530 C960,710 770,850 500,850 C230,850 40,710 40,530 C40,350 230,200 500,200 Z',
      shape2: 'M530,180 C800,190 980,340 970,530 C960,720 760,860 480,850 C200,840 20,690 40,500 C60,310 280,170 530,180 Z',
      shape3: 'M470,210 C750,200 950,360 940,540 C930,720 740,850 460,840 C180,830 10,680 30,500 C50,320 210,220 470,210 Z',
      shape4: 'M510,190 C790,200 970,350 960,540 C950,730 760,860 480,850 C200,840 20,690 40,500 C60,310 260,180 510,190 Z',
    },
    shadow1: {
      shape1: 'M500,140 C820,140 1040,320 1040,540 C1040,760 820,940 500,940 C180,940 -40,760 -40,540 C-40,320 180,140 500,140 Z',
      shape2: 'M530,120 C860,130 1060,310 1050,550 C1040,790 810,950 490,940 C170,930 -50,750 -20,510 C10,270 230,110 530,120 Z',
      shape3: 'M470,150 C800,140 1020,330 1010,560 C1000,790 790,930 470,920 C150,910 -40,730 -10,500 C20,270 170,160 470,150 Z',
      shape4: 'M510,130 C840,140 1050,320 1040,550 C1030,780 810,940 490,930 C170,920 -40,750 -10,520 C20,290 210,120 510,130 Z',
    },
    shadow2: {
      shape1: 'M500,160 C810,160 1020,330 1020,550 C1020,770 810,930 500,930 C190,930 -20,770 -20,550 C-20,330 190,160 500,160 Z',
      shape2: 'M530,140 C850,150 1040,320 1030,560 C1020,800 800,950 480,940 C160,930 -40,760 -10,520 C20,280 240,130 530,140 Z',
      shape3: 'M470,170 C790,160 1010,340 1000,570 C990,800 780,940 460,930 C140,920 -40,750 -10,520 C20,290 180,180 470,170 Z',
      shape4: 'M510,150 C830,160 1030,330 1020,560 C1010,790 800,940 480,930 C160,920 -40,760 -10,530 C20,300 220,140 510,150 Z',
    },
  },
  work: {
    blob1: {
      shape1: 'M550,120 C850,80 1000,280 980,520 C960,760 720,950 420,920 C120,890 -20,680 50,440 C120,200 300,160 550,120 Z',
      shape2: 'M580,100 C880,70 1020,260 1000,510 C980,760 740,960 430,930 C120,900 -30,690 40,440 C110,190 330,130 580,100 Z',
      shape3: 'M520,140 C820,100 980,300 960,540 C940,780 700,960 400,930 C100,900 -30,690 50,450 C130,210 270,180 520,140 Z',
      shape4: 'M560,110 C860,80 1010,270 990,520 C970,770 730,960 420,930 C110,900 -30,690 50,440 C130,190 310,140 560,110 Z',
    },
    blob2: {
      shape1: 'M530,150 C820,120 970,310 950,540 C930,770 700,940 410,910 C120,880 -10,680 60,450 C130,220 290,180 530,150 Z',
      shape2: 'M560,130 C850,100 990,290 970,530 C950,770 720,950 420,920 C120,890 -20,690 50,450 C120,210 310,160 560,130 Z',
      shape3: 'M510,160 C800,130 960,320 940,550 C920,780 690,950 400,920 C110,890 -20,690 60,460 C140,230 270,190 510,160 Z',
      shape4: 'M550,140 C840,110 980,300 960,540 C940,780 710,950 410,920 C110,890 -20,690 60,450 C140,210 300,170 550,140 Z',
    },
    shadow1: {
      shape1: 'M560,80 C900,40 1070,260 1050,540 C1030,820 760,1020 420,990 C80,960 -80,720 10,440 C100,160 280,120 560,80 Z',
      shape2: 'M590,60 C930,30 1090,240 1070,530 C1050,820 780,1030 430,1000 C80,970 -90,730 0,440 C90,150 310,90 590,60 Z',
      shape3: 'M530,100 C870,60 1050,280 1030,560 C1010,840 740,1030 390,1000 C40,970 -90,730 10,450 C110,170 250,140 530,100 Z',
      shape4: 'M570,70 C910,40 1080,250 1060,540 C1040,830 770,1030 420,1000 C70,970 -90,730 0,440 C90,150 290,100 570,70 Z',
    },
    shadow2: {
      shape1: 'M540,100 C880,60 1050,270 1030,550 C1010,830 750,1020 410,990 C70,960 -80,720 10,450 C100,180 260,140 540,100 Z',
      shape2: 'M570,80 C910,50 1070,260 1050,550 C1030,840 770,1030 420,1000 C70,970 -90,730 0,450 C90,170 290,110 570,80 Z',
      shape3: 'M520,110 C860,70 1040,290 1020,570 C1000,850 740,1030 390,1000 C40,970 -90,730 10,460 C110,190 240,150 520,110 Z',
      shape4: 'M560,90 C900,50 1060,270 1040,560 C1020,850 760,1030 410,1000 C60,970 -90,730 0,450 C90,170 280,130 560,90 Z',
    },
  },
  resources: {
    blob1: {
      shape1: 'M520,140 C800,100 980,300 960,540 C940,780 700,960 400,920 C100,880 -10,660 60,420 C130,180 290,180 520,140 Z',
      shape2: 'M550,120 C830,90 1000,280 980,530 C960,780 720,970 410,930 C100,890 -20,670 50,420 C120,170 320,150 550,120 Z',
      shape3: 'M490,150 C770,110 960,320 940,560 C920,800 690,970 380,930 C70,890 -20,660 60,430 C140,200 260,190 490,150 Z',
      shape4: 'M530,130 C810,100 990,290 970,540 C950,790 710,970 400,930 C90,890 -20,670 50,420 C120,170 300,160 530,130 Z',
    },
    blob2: {
      shape1: 'M500,160 C780,130 960,320 940,560 C920,800 680,970 380,930 C80,890 -20,660 60,430 C140,200 270,190 500,160 Z',
      shape2: 'M530,140 C810,110 980,310 960,550 C940,790 700,970 390,930 C80,890 -30,670 50,430 C130,190 300,170 530,140 Z',
      shape3: 'M480,170 C760,140 950,330 930,570 C910,810 680,980 370,940 C60,900 -30,670 50,440 C130,210 250,200 480,170 Z',
      shape4: 'M510,150 C790,120 970,320 950,560 C930,800 690,980 380,940 C70,900 -30,670 50,430 C130,190 280,180 510,150 Z',
    },
    shadow1: {
      shape1: 'M530,100 C850,60 1050,280 1030,560 C1010,840 740,1040 390,1000 C40,960 -80,700 20,420 C120,140 270,140 530,100 Z',
      shape2: 'M560,80 C880,50 1070,260 1050,550 C1030,840 760,1050 400,1010 C40,970 -90,710 10,420 C110,130 300,110 560,80 Z',
      shape3: 'M500,110 C820,70 1030,300 1010,580 C990,860 720,1050 370,1010 C20,970 -90,710 20,430 C130,150 240,150 500,110 Z',
      shape4: 'M540,90 C860,60 1060,270 1040,560 C1020,850 750,1050 390,1010 C30,970 -90,710 20,420 C130,130 290,120 540,90 Z',
    },
    shadow2: {
      shape1: 'M510,120 C830,80 1030,290 1010,570 C990,850 730,1040 380,1000 C30,960 -80,710 20,430 C120,150 250,160 510,120 Z',
      shape2: 'M540,100 C860,70 1050,280 1030,570 C1010,860 750,1050 390,1010 C30,970 -90,720 10,430 C110,140 280,130 540,100 Z',
      shape3: 'M490,130 C810,90 1020,310 1000,590 C980,870 720,1050 370,1010 C20,970 -90,720 20,440 C130,160 230,170 490,130 Z',
      shape4: 'M520,110 C840,80 1040,290 1020,580 C1000,870 740,1050 380,1010 C20,970 -90,720 10,430 C110,140 270,140 520,110 Z',
    },
  },
  partners: {
    blob1: {
      shape1: 'M540,130 C830,90 1000,290 980,530 C960,770 710,960 400,920 C90,880 -20,660 60,420 C140,180 300,170 540,130 Z',
      shape2: 'M570,110 C860,80 1020,280 1000,530 C980,780 730,970 410,930 C90,890 -30,670 50,420 C130,170 330,140 570,110 Z',
      shape3: 'M510,140 C800,100 980,310 960,550 C940,790 700,970 390,930 C80,890 -30,670 60,430 C150,190 270,180 510,140 Z',
      shape4: 'M550,120 C840,90 1010,290 990,540 C970,790 720,970 400,930 C80,890 -30,670 50,420 C130,170 310,150 550,120 Z',
    },
    blob2: {
      shape1: 'M520,150 C810,120 980,310 960,550 C940,790 700,970 390,930 C80,890 -30,670 60,430 C150,190 280,180 520,150 Z',
      shape2: 'M550,130 C840,100 1000,300 980,550 C960,800 720,980 400,940 C80,900 -40,680 50,430 C140,180 310,160 550,130 Z',
      shape3: 'M500,160 C790,130 970,320 950,560 C930,800 690,980 380,940 C70,900 -40,680 60,440 C160,200 260,190 500,160 Z',
      shape4: 'M530,140 C820,110 990,310 970,560 C950,810 710,980 390,940 C70,900 -40,680 50,430 C140,180 290,170 530,140 Z',
    },
    shadow1: {
      shape1: 'M550,90 C880,50 1070,270 1050,550 C1030,830 750,1030 390,990 C30,950 -90,700 10,420 C110,140 280,130 550,90 Z',
      shape2: 'M580,70 C910,40 1090,260 1070,550 C1050,840 770,1040 400,1000 C30,960 -100,710 0,420 C100,130 310,100 580,70 Z',
      shape3: 'M520,100 C850,60 1050,290 1030,570 C1010,850 740,1040 380,1000 C20,960 -100,710 10,430 C120,150 260,140 520,100 Z',
      shape4: 'M560,80 C890,50 1080,270 1060,560 C1040,850 760,1040 390,1000 C20,960 -100,710 0,420 C100,130 290,110 560,80 Z',
    },
    shadow2: {
      shape1: 'M530,110 C860,70 1050,280 1030,560 C1010,840 740,1040 380,1000 C20,960 -90,710 10,430 C110,150 270,150 530,110 Z',
      shape2: 'M560,90 C890,60 1070,270 1050,560 C1030,850 760,1050 390,1010 C20,970 -100,720 0,430 C100,140 300,120 560,90 Z',
      shape3: 'M510,120 C840,80 1040,300 1020,580 C1000,860 730,1050 370,1010 C10,970 -100,720 10,440 C120,160 250,160 510,120 Z',
      shape4: 'M550,100 C880,70 1060,280 1040,570 C1020,860 750,1050 380,1010 C10,970 -100,720 0,430 C100,140 290,130 550,100 Z',
    },
  },
  contact: {
    blob1: {
      shape1: 'M520,160 C800,140 980,320 970,540 C960,760 740,920 460,900 C180,880 20,700 50,480 C80,260 280,180 520,160 Z',
      shape2: 'M550,140 C830,120 1000,300 990,530 C980,760 760,930 470,910 C180,890 10,710 40,480 C70,250 310,160 550,140 Z',
      shape3: 'M490,170 C770,150 960,340 950,560 C940,780 730,930 450,910 C170,890 20,710 50,490 C80,270 250,190 490,170 Z',
      shape4: 'M530,150 C810,130 990,320 980,550 C970,780 750,930 460,910 C170,890 20,710 50,480 C80,250 290,170 530,150 Z',
    },
    blob2: {
      shape1: 'M500,180 C780,160 960,340 950,560 C940,780 720,930 440,910 C160,890 20,710 50,490 C80,270 260,200 500,180 Z',
      shape2: 'M530,160 C810,140 980,330 970,560 C960,790 740,940 450,920 C160,900 10,720 40,490 C70,260 290,180 530,160 Z',
      shape3: 'M480,190 C760,170 950,360 940,580 C930,800 710,950 430,930 C150,910 10,730 50,500 C90,270 240,210 480,190 Z',
      shape4: 'M510,170 C790,150 970,350 960,570 C950,790 730,940 440,920 C150,900 10,720 40,490 C70,260 270,190 510,170 Z',
    },
    shadow1: {
      shape1: 'M530,120 C850,100 1050,300 1040,560 C1030,820 780,1000 450,980 C120,960 -50,760 0,500 C50,240 260,140 530,120 Z',
      shape2: 'M560,100 C880,80 1070,280 1060,550 C1050,820 800,1010 460,990 C120,970 -60,770 -10,500 C40,230 290,120 560,100 Z',
      shape3: 'M500,130 C820,110 1030,320 1020,580 C1010,840 770,1010 430,990 C90,970 -60,780 0,510 C60,240 230,150 500,130 Z',
      shape4: 'M540,110 C860,90 1060,300 1050,570 C1040,840 790,1010 450,990 C110,970 -60,780 -10,510 C40,240 280,130 540,110 Z',
    },
    shadow2: {
      shape1: 'M510,140 C830,120 1030,310 1020,570 C1010,830 770,1000 440,980 C110,960 -50,770 0,510 C50,250 240,160 510,140 Z',
      shape2: 'M540,120 C860,100 1050,300 1040,570 C1030,840 790,1010 450,990 C110,970 -60,780 -10,510 C40,240 270,140 540,120 Z',
      shape3: 'M490,150 C810,130 1020,330 1010,590 C1000,850 770,1020 430,1000 C90,980 -60,790 0,520 C60,250 220,170 490,150 Z',
      shape4: 'M520,130 C840,110 1040,310 1030,580 C1020,850 780,1020 440,1000 C100,980 -60,790 -10,520 C40,250 260,150 520,130 Z',
    },
  },
  merch: {
    blob1: {
      shape1: 'M530,150 C820,120 990,310 970,540 C950,770 710,950 410,910 C110,870 -20,660 60,430 C140,200 290,180 530,150 Z',
      shape2: 'M560,130 C850,100 1010,290 990,530 C970,770 730,960 420,920 C110,880 -30,670 50,430 C130,190 320,160 560,130 Z',
      shape3: 'M500,160 C790,130 970,320 950,550 C930,780 700,960 400,920 C100,880 -30,670 60,440 C150,210 260,190 500,160 Z',
      shape4: 'M540,140 C830,110 1000,300 980,540 C960,780 720,960 410,920 C100,880 -30,670 50,430 C130,190 300,170 540,140 Z',
    },
    blob2: {
      shape1: 'M510,170 C800,140 970,330 950,560 C930,790 700,960 400,920 C100,880 -30,670 60,440 C150,210 270,200 510,170 Z',
      shape2: 'M540,150 C830,120 990,320 970,560 C950,800 720,970 410,930 C100,890 -40,680 50,440 C140,200 300,180 540,150 Z',
      shape3: 'M490,180 C780,150 960,340 940,570 C920,800 690,970 390,930 C90,890 -40,680 60,450 C160,220 250,210 490,180 Z',
      shape4: 'M520,160 C810,130 980,330 960,570 C940,810 710,970 400,930 C90,890 -40,680 50,440 C140,200 280,190 520,160 Z',
    },
    shadow1: {
      shape1: 'M540,110 C870,70 1060,290 1040,560 C1020,830 760,1020 400,980 C40,940 -90,700 10,430 C110,160 270,150 540,110 Z',
      shape2: 'M570,90 C900,60 1080,280 1060,560 C1040,840 780,1030 410,990 C40,950 -100,710 0,430 C100,150 300,120 570,90 Z',
      shape3: 'M510,120 C840,80 1040,310 1020,580 C1000,850 750,1030 390,990 C30,950 -100,710 10,440 C120,170 250,160 510,120 Z',
      shape4: 'M550,100 C880,70 1070,290 1050,570 C1030,850 770,1030 400,990 C30,950 -100,710 0,430 C100,150 280,130 550,100 Z',
    },
    shadow2: {
      shape1: 'M520,130 C850,90 1040,300 1020,570 C1000,840 750,1030 390,990 C30,950 -90,710 10,440 C110,170 260,170 520,130 Z',
      shape2: 'M550,110 C880,80 1060,290 1040,570 C1020,850 770,1040 400,1000 C30,960 -100,720 0,440 C100,160 290,140 550,110 Z',
      shape3: 'M500,140 C830,100 1030,320 1010,590 C990,860 740,1040 380,1000 C20,960 -100,720 10,450 C120,180 240,180 500,140 Z',
      shape4: 'M540,120 C870,90 1050,300 1030,580 C1010,860 760,1040 390,1000 C20,960 -100,720 0,440 C100,160 280,150 540,120 Z',
    },
  },
  services: {
    blob1: {
      shape1: 'M500,180 C780,180 980,340 980,520 C980,700 780,860 500,860 C220,860 20,700 20,520 C20,340 220,180 500,180 Z',
      shape2: 'M520,160 C810,170 1000,330 990,530 C980,730 770,870 490,860 C210,850 10,690 30,490 C50,290 260,150 520,160 Z',
      shape3: 'M480,190 C760,180 960,350 950,540 C940,730 750,860 470,850 C190,840 10,680 30,490 C50,300 220,200 480,190 Z',
      shape4: 'M510,170 C800,180 990,340 980,530 C970,720 770,860 490,850 C210,840 20,690 40,500 C60,310 250,160 510,170 Z',
    },
    blob2: {
      shape1: 'M500,200 C770,200 960,350 960,530 C960,710 770,850 500,850 C230,850 40,710 40,530 C40,350 230,200 500,200 Z',
      shape2: 'M530,180 C800,190 980,340 970,530 C960,720 760,860 480,850 C200,840 20,690 40,500 C60,310 280,170 530,180 Z',
      shape3: 'M470,210 C750,200 950,360 940,540 C930,720 740,850 460,840 C180,830 10,680 30,500 C50,320 210,220 470,210 Z',
      shape4: 'M510,190 C790,200 970,350 960,540 C950,730 760,860 480,850 C200,840 20,690 40,500 C60,310 260,180 510,190 Z',
    },
    shadow1: {
      shape1: 'M500,140 C820,140 1040,320 1040,540 C1040,760 820,940 500,940 C180,940 -40,760 -40,540 C-40,320 180,140 500,140 Z',
      shape2: 'M530,120 C860,130 1060,310 1050,550 C1040,790 810,950 490,940 C170,930 -50,750 -20,510 C10,270 230,110 530,120 Z',
      shape3: 'M470,150 C800,140 1020,330 1010,560 C1000,790 790,930 470,920 C150,910 -40,730 -10,500 C20,270 170,160 470,150 Z',
      shape4: 'M510,130 C840,140 1050,320 1040,550 C1030,780 810,940 490,930 C170,920 -40,750 -10,520 C20,290 210,120 510,130 Z',
    },
    shadow2: {
      shape1: 'M500,160 C810,160 1020,330 1020,550 C1020,770 810,930 500,930 C190,930 -20,770 -20,550 C-20,330 190,160 500,160 Z',
      shape2: 'M530,140 C850,150 1040,320 1030,560 C1020,800 800,950 480,940 C160,930 -40,760 -10,520 C20,280 240,130 530,140 Z',
      shape3: 'M470,170 C790,160 1010,340 1000,570 C990,800 780,940 460,930 C140,920 -40,750 -10,520 C20,290 180,180 470,170 Z',
      shape4: 'M510,150 C830,160 1030,330 1020,560 C1010,790 800,940 480,930 C160,920 -40,760 -10,530 C20,300 220,140 510,150 Z',
    },
  },
}

export default function LiquidBlob({
  className = '',
  page = 'homepage',
  rotation = 0,
  enableMouseFollow = false,
  animationSpeed = 1,
  shapeScale = 1
}: LiquidBlobProps) {
  const blobRef = useRef<SVGSVGElement>(null)
  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 })
  const [blobCenter, setBlobCenter] = useState({ x: 0, y: 0 })
  const [isHovering, setIsHovering] = useState(false)

  const shapes = pageShapes[page]

  const animationId = useMemo(() => page, [page])

  // Calculate animation durations based on speed multiplier
  const blob1Duration = 10 * animationSpeed
  const blob2Duration = 11 * animationSpeed

  const generateKeyframes = useMemo(() => `
    @keyframes blob1-morph-${animationId} {
      0%, 100% { d: path("${shapes.blob1.shape1}"); }
      25% { d: path("${shapes.blob1.shape2}"); }
      50% { d: path("${shapes.blob1.shape3}"); }
      75% { d: path("${shapes.blob1.shape4}"); }
    }
    
    @keyframes blob2-morph-${animationId} {
      0%, 100% { d: path("${shapes.blob2.shape1}"); }
      25% { d: path("${shapes.blob2.shape2}"); }
      50% { d: path("${shapes.blob2.shape3}"); }
      75% { d: path("${shapes.blob2.shape4}"); }
    }
  `, [shapes, animationId])

  useEffect(() => {
    if (!enableMouseFollow) return

    const updateBlobCenter = () => {
      if (blobRef.current) {
        const rect = blobRef.current.getBoundingClientRect()
        setBlobCenter({
          x: rect.left + rect.width / 2,
          y: rect.top + rect.height / 2,
        })
      }
    }

    updateBlobCenter()
    window.addEventListener('resize', updateBlobCenter)
    window.addEventListener('scroll', updateBlobCenter)

    return () => {
      window.removeEventListener('resize', updateBlobCenter)
      window.removeEventListener('scroll', updateBlobCenter)
    }
  }, [enableMouseFollow])

  useEffect(() => {
    if (!enableMouseFollow) return

    let animationFrameId: number
    let currentX = 0
    let currentY = 0
    let targetX = 0
    let targetY = 0

    const handleMouseMove = (e: MouseEvent) => {
      const dx = e.clientX - blobCenter.x
      const dy = e.clientY - blobCenter.y
      const distance = Math.sqrt(dx * dx + dy * dy)
      const maxDistance = 500

      if (distance < maxDistance) {
        setIsHovering(true)
        const strength = 1 - distance / maxDistance
        targetX = dx * strength * 0.1
        targetY = dy * strength * 0.1
      } else {
        setIsHovering(false)
        targetX = 0
        targetY = 0
      }
    }

    const animate = () => {
      const easing = 0.06
      currentX += (targetX - currentX) * easing
      currentY += (targetY - currentY) * easing

      setMousePosition({ x: currentX, y: currentY })
      animationFrameId = requestAnimationFrame(animate)
    }

    window.addEventListener('mousemove', handleMouseMove)
    animationFrameId = requestAnimationFrame(animate)

    return () => {
      window.removeEventListener('mousemove', handleMouseMove)
      cancelAnimationFrame(animationFrameId)
    }
  }, [blobCenter, enableMouseFollow])

  return (
    <div className={`absolute pointer-events-none ${className}`}>
      <style dangerouslySetInnerHTML={{ __html: generateKeyframes }} />
      <svg
        ref={blobRef}
        viewBox="-100 -100 1200 1200"
        className="w-full h-full overflow-visible"
        preserveAspectRatio="xMidYMid meet"
        style={{
          transform: enableMouseFollow
            ? `translate(${mousePosition.x}px, ${mousePosition.y}px) rotate(${rotation}deg)`
            : `rotate(${rotation}deg)`,
          transition: isHovering ? 'none' : 'transform 0.8s ease-out',
        }}
      >
        <g transform="translate(-900, -140) scale(2.1, 1.05)">
          <path
            fill="#1DEFFA"
            opacity="0.3"
            d={shapes.blob2.shape1}
            style={{
              animation: `blob2-morph-${animationId} ${blob2Duration}s ease-in-out infinite`,
            }}
          />
        </g>
        <g transform="translate(-240, 80) scale(1.5, 0.85)">
          <path
            fill="#03C1CA"
            opacity="1"
            d={shapes.blob1.shape1}
            style={{
              animation: `blob1-morph-${animationId} ${blob1Duration}s ease-in-out infinite`,
            }}
          />
        </g>
      </svg>
    </div>
  )
}
